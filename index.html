<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ひらがなパズル（レスポンシブ）</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f4f4f4;
      text-align: center;
    }

    h1 {
      margin: 20px 0;
    }

    #game-board {
      /* 画面幅に合わせて横幅を縮める（余白を少し空ける） */
      width: 90vw;
      max-width: 1000px; /* 大きい画面でも横幅が広がりすぎないよう制限 */
      margin: 0 auto;
      display: grid;
      gap: 10px;

      /* 
        画面サイズに応じて列数を自動調整する例:
        repeat(auto-fill, minmax(80px, 1fr)) 
        
        今回は 4 列固定にしたい場合は: repeat(4, 1fr)
      */
      grid-template-columns: repeat(3, 1fr);
    }

    /* カードのデザイン */
    .card {
      background-color: #ffcccc;
      border-radius: 8px;
      font-size: 2rem;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;

      /* 
        aspect-ratio: 1 で「縦横比 1:1 の正方形」を保つ 
        (対応していないブラウザの場合は後述のフォールバックが必要)
      */
      aspect-ratio: 1 / 1; 
    }

    .card.flipped {
      background-color: #fff;
    }

    .card.hidden {
      visibility: hidden;
    }

    #message {
      font-size: 1.2rem;
      margin-top: 10px;
      color: #333;
    }

    #restart-btn {
      display: inline-block;
      margin: 20px;
      padding: 10px 20px;
      background-color: #ff9999;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #restart-btn:hover {
      background-color: #ff5555;
    }
  </style>
</head>
<body>
  <h1>ひらがなパズル</h1>
  <div id="game-board"></div>
  <div id="message"></div>
  <button id="restart-btn">リスタート</button>

  <script>
    // 使用するひらがな
    const hiraganaArray = ["あ", "い", "う", "え", "か", "き", "く", "け"];

    let board = document.getElementById("game-board");
    let message = document.getElementById("message");
    let restartBtn = document.getElementById("restart-btn");

    let cards = [];
    let flippedCards = [];
    let matchedCount = 0;

    // ゲーム初期化
    function initGame() {
      message.textContent = "";
      board.innerHTML = "";

      cards = [];
      flippedCards = [];
      matchedCount = 0;

      // ひらがなを2セット用意
      let cardValues = hiraganaArray.concat(hiraganaArray);

      // シャッフル
      shuffleArray(cardValues);

      // カード生成
      cardValues.forEach((value, index) => {
        let card = document.createElement("div");
        card.classList.add("card");
        card.dataset.value = value;
        card.dataset.index = index;

        card.addEventListener("click", () => {
          flipCard(card);
        });

        cards.push(card);
        board.appendChild(card);
      });
    }

    // 配列シャッフル (Fisher-Yates)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // カードをめくる
    function flipCard(card) {
      if (
        card.classList.contains("flipped") ||
        card.classList.contains("hidden") ||
        flippedCards.length === 2
      ) {
        return;
      }
      card.classList.add("flipped");
      card.textContent = card.dataset.value;
      flippedCards.push(card);

      if (flippedCards.length === 2) {
        checkMatch();
      }
    }

    // マッチ判定
    function checkMatch() {
      let card1 = flippedCards[0];
      let card2 = flippedCards[1];

      if (card1.dataset.value === card2.dataset.value) {
        // マッチ
        setTimeout(() => {
          card1.classList.add("hidden");
          card2.classList.add("hidden");
          matchedCount++;
          flippedCards = [];

          if (matchedCount === hiraganaArray.length) {
            message.textContent = "おめでとうございます！全部マッチしました！";
          }
        }, 500);
      } else {
        // 不一致
        setTimeout(() => {
          card1.classList.remove("flipped");
          card2.classList.remove("flipped");
          card1.textContent = "";
          card2.textContent = "";
          flippedCards = [];
        }, 1000);
      }
    }

    // リスタート
    restartBtn.addEventListener("click", initGame);

    // ページ読み込み時に初期化
    window.onload = initGame;
  </script>
</body>
</html>
