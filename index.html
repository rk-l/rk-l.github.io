<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ひらがなパズル（動物画像表示・フリー素材）</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f4f4f4;
      text-align: center;
    }

    h1 {
      margin: 20px 0;
    }

    #game-board {
      width: 90vw;
      max-width: 600px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .card {
      background-color: #ffcccc;
      border-radius: 8px;
      font-size: 2rem;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
      aspect-ratio: 1 / 1; /* 正方形を維持 (対応ブラウザ) */
    }

    .card.flipped {
      background-color: #fff;
    }

    .card.hidden {
      visibility: hidden;
    }

    #message {
      font-size: 1.2rem;
      margin-top: 10px;
      color: #333;
    }

    #restart-btn {
      display: inline-block;
      margin: 20px;
      padding: 10px 20px;
      background-color: #ff9999;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #restart-btn:hover {
      background-color: #ff5555;
    }

    /* オーバーレイのスタイル */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s, visibility 0.3s;
    }
    .overlay.show {
      visibility: visible;
      opacity: 1;
    }
    /* 画像表示用 */
    .overlay img {
      max-width: 80%;
      max-height: 80%;
      border: 5px solid #fff;
      border-radius: 10px;
      background-color: #fff;
    }
  </style>
</head>
<body>
  <h1>ひらがなパズル</h1>
  <div id="game-board"></div>
  <div id="message"></div>
  <button id="restart-btn">リスタート</button>

  <!-- 動物画像を表示するオーバーレイ -->
  <div class="overlay" id="overlay">
    <img id="animal-image" src="" alt="動物画像">
  </div>

  <script>
    // 使用するひらがな
    const hiraganaArray = ["あ", "い", "う", "え", "か", "き", "く", "け"];

    // Pixabayフリー素材画像のマッピング（2025年1月時点）
    // お好きな画像に差し替えてください
    const animalImages = {
      "あ": {
        name: "あざらし",
        url: "images/seal.png"
      },
      "い": {
        name: "いぬ",
        url: "images/dog.png"
      },
      "う": {
        name: "うさぎ",
        url: "images/rabbit.png"
      },
      "え": {
        name: "えび",
        url: "images/shrimp.png"
      },
      "か": {
        name: "かば",
        url: "images/hipopotamus.png"
      },
      "き": {
        name: "きじ",
        url: "images/pheasant.png"
      },
      "く": {
        name: "くま",
        url: "images/bear.png"
      },
      "け": {
        name: "けーぷぺんぎん",
        url: "images/capepenguin.png"
      }
    };

    let board = document.getElementById("game-board");
    let message = document.getElementById("message");
    let restartBtn = document.getElementById("restart-btn");

    // オーバーレイ要素
    const overlay = document.getElementById("overlay");
    const animalImage = document.getElementById("animal-image");

    let cards = [];
    let flippedCards = [];
    let matchedCount = 0;

    // ゲーム初期化
    function initGame() {
      message.textContent = "";
      board.innerHTML = "";

      cards = [];
      flippedCards = [];
      matchedCount = 0;

      // ひらがなを2セット用意 (合計16枚)
      let cardValues = hiraganaArray.concat(hiraganaArray);

      // シャッフル
      shuffleArray(cardValues);

      // カード生成
      cardValues.forEach((value, index) => {
        let card = document.createElement("div");
        card.classList.add("card");
        card.dataset.value = value;
        card.dataset.index = index;

        card.addEventListener("click", () => {
          flipCard(card);
        });

        cards.push(card);
        board.appendChild(card);
      });
    }

    // 配列シャッフル (Fisher-Yates)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // カードをめくる
    function flipCard(card) {
      // すでにめくられているカードや非表示のカードは無視
      if (
        card.classList.contains("flipped") ||
        card.classList.contains("hidden") ||
        flippedCards.length === 2
      ) {
        return;
      }
      card.classList.add("flipped");
      card.textContent = card.dataset.value;
      flippedCards.push(card);

      if (flippedCards.length === 2) {
        checkMatch();
      }
    }

    // マッチ判定
    function checkMatch() {
      let card1 = flippedCards[0];
      let card2 = flippedCards[1];

      if (card1.dataset.value === card2.dataset.value) {
        // マッチ
        setTimeout(() => {
          // カードを非表示
          card1.classList.add("hidden");
          card2.classList.add("hidden");

          matchedCount++;

          // ここで動物画像を表示（ひらがなから動物名を特定）
          const matchedHiragana = card1.dataset.value;
          showAnimalOverlay(matchedHiragana);

          flippedCards = [];

          // 全部マッチしたかどうか
          if (matchedCount === hiraganaArray.length) {
            message.textContent = "おめでとうございます！全部マッチしました！";
          }
        }, 500);
      } else {
        // 不一致
        setTimeout(() => {
          card1.classList.remove("flipped");
          card2.classList.remove("flipped");
          card1.textContent = "";
          card2.textContent = "";
          flippedCards = [];
        }, 1000);
      }
    }

    // 動物画像のオーバーレイを表示する
    function showAnimalOverlay(hiragana) {
      if (animalImages[hiragana]) {
        animalImage.src = animalImages[hiragana].url;
        animalImage.alt = animalImages[hiragana].name;
      } else {
        animalImage.src = "";
        animalImage.alt = "画像が見つかりません";
      }
      overlay.classList.add("show");
    

      // 3 seconds はクリックを無効にする
      overlayLocked = true;
      setTimeout(() => {
        overlayLocked = false;
      }, 3000);
    }

    // オーバーレイを閉じる（クリックイベント）
    overlay.addEventListener("click", () => {
      // ロック中は何もしない
      if (overlayLocked) {
        return;
      }
      hideAnimalOverlay();
    });

    function hideAnimalOverlay() {
      overlay.classList.remove("show");
      // 画像をリセットしたいなら:
      animalImg.src = "";
    }

    // リスタート
    restartBtn.addEventListener("click", initGame);

    // オーバーレイクリックで閉じる
    overlay.addEventListener("click", hideAnimalOverlay);

    // ページ読み込み時に初期化
    window.onload = initGame;
  </script>
</body>
</html>
